<template>
  <div class="vuln-pie-chart">
    <div class="charts">
      <div ref="chart1" class="chart"></div>
      <div ref="chart2" class="chart"></div>
    </div>
    <div class="desc">
      本季度较上季度增加 459 个漏洞，主要未修复原因：设备过保。
    </div>
  </div>
</template>

<script>
import * as echarts from 'echarts';

export default {

  mounted() {
    this.initCharts();
  },
  methods: {
    initCharts() {
      const chart1 = echarts.init(this.$refs.chart1);
      const chart2 = echarts.init(this.$refs.chart2);

      const option1 = {
        title: {
          text: '本季度漏洞分布',
          left: 'center',
          top: 0,
          textStyle: {color: '#fcf003', fontSize: 16}
        },
        tooltip: {
          trigger: 'item',
          position: 'right',
          formatter: '{b}: {c} ({d}%)'
        },
        legend: {
          orient: 'horizontal',
          left: 'center',
          top: 'bottom',
          itemWidth: 10,
          itemHeight: 10,
          itemGap: 8,
          textStyle: {
            fontSize: 12,
            color: '#fff'
          }
        },
        series: [
          {
            name: '漏洞等级',
            type: 'pie',
            radius: ['40%','70%'],
            avoidLabelOverlap:false,
            label: {
              show: false,
              position: 'center'
            },
            emphasis: {
              label: {
                show: true,
                fontSize: 15,
                fontWeight: 'bold'
              }
            },
            labelLine: {
              show: false
            },
            data: [
              {value: 119, name: '高危漏洞'},
              {value: 91, name: '中危漏洞'},
              {value: 2746, name: '低危漏洞'}
            ],
            color: ['#ff4d4f', '#faad14', '#479eef'],

          }
        ]
      };

      const total = 2949;
      const unrepaired = +(total * 0.7942).toFixed(0);
      const repaired = total - unrepaired;

      const option2 = {
        title: {
          text: '上季度漏洞修复情况',
          left: 'center',
          top: 0,
          textStyle: {color: '#00ffa6', fontSize: 16}
        },
        tooltip: {
          trigger: 'item',
          position: 'left',
          formatter: '{b}: {c} ({d}%)'
        },
        legend: {
          orient: 'horizontal',
          left: 'center',
          top: 'bottom',
          itemWidth: 10,
          itemHeight: 10,
          itemGap: 8,
          textStyle: {
            fontSize: 12,
            color: '#fff'
          }
        },
        series: [
          {
            name: '修复情况',
            type: 'pie',
            radius: ['40%','70%'],
            avoidLabelOverlap: false,
            label: {
              show: false,
              position: 'center'
            },
            emphasis: {
              label: {
                show: true,
                fontSize: 15,
                fontWeight: 'bold'
              }
            },
            labelLine: {
              show: false
            },
            data: [
              {value: repaired, name: '已修复'},
              {value: unrepaired, name: '未修复'}
            ],
            color: ['#52c41a', '#00ffd9'],

          }
        ]
      };

      chart1.setOption(option1);
      chart2.setOption(option2);

      // 自适应大小
      window.addEventListener('resize', () => {
        chart1.resize();
        chart2.resize();
      });
    }
  }
};
</script>

<style scoped>
.vuln-pie-chart {
  max-height: 310px;
  max-width: 720px;
  margin: auto;
  padding: 10px;
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}



.charts {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: nowrap;
}

.chart {
  width: 45%;
  height: 220px;
  min-width: 220px;
}

.desc {
  margin-top: 2px;
  font-size: 14px;
  font-weight: bold;
  color: #fc1a1a;
  line-height: 1.8;
  text-align: center;
}


</style>
